<!DOCTYPE html >
<html>
<head>
	<meta charset="utf-8"/>
	<meta http-equiv="Content-Type" content="text/html;charset=UTF-8" />
	
	<meta content="width=device-width; initial-scale=1.0; maximum-scale=1.0; user-scalable=0" name="viewport" />
	<title></title>
<style type="text/css">
.text{font-size:20px;}


</style>
</head>
<body>

	<div  id="test" class="text" >aaaa</div>
	<device type="media" onchange="update(this.data)"></device>
	<video id="video" width="10" height="10" autoplay></video>
	<canvas id="canvas" width="300" height="500"></canvas>
<script type="text/javascript">
 	 function update(stream) {
 	   document.querySelector('video').src = stream.url;
 	 }
</script>
<script type="text/javascript">
var GameObj = {};
var width = 300,height = 500;
(function (obj){


	var addOrientaionListener = function(orientationListener) {
	// body...
		window.addEventListener('deviceorientation',orientationListener,false);//方向感应器??
		window.addEventListener('MozOrientation',orientationListener,false);//
		window.addEventListener('devicemotion',orientationListener,false);//
	};

	obj.acceleration = {};
	obj.addOrientaionListener = addOrientaionListener;


})(GameObj);

function getUserMedia(){

	function success(stream){
		//console.log(stream);
		var video = document.querySelector('#video');
		var canvas = document.querySelector('#canvas');
		video.src = window.webkitURL?webkitURL.createObjectURL(stream):stream;
	    video.onerror = function () {
	            stream.stop();
	           
	    };


	    setInterval(function () {
	    	// body...  
	    	draw(canvas, video);
	    }, 66);
	}

	if(navigator.getUserMedia){

		navigator.getUserMedia("video", success);
	}else if(navigator.webkitGetUserMedia){
		navigator.webkitGetUserMedia({video:true}, success, function(){});
	}

	

}

var _c = 0;
function draw(canvas, video){
	var ctx = canvas.getContext('2d');  
    var cw = canvas.width;  
    var ch = canvas.height;
    ctx.drawImage(video, 0,0,cw,ch);

    var C = Math.tan( GameObj.acceleration.beta*(Math.PI/180) )*(width/2);
    _c = C;
    ctx.strokeStyle = '#ffffff';
    ctx.lineWidth = 5;
    ctx.moveTo(0, C);
    ctx.lineTo(width, C);
    ctx.stroke();

}

getUserMedia();

function oriCallback(evt){


	// For FF3.6+
	if (!evt.gamma && !evt.beta) {
		// angle=radian*180.0/PI 在firefox中x和y是弧度值,
		evt.gamma = (evt.x * (180 / Math.PI)); //转换成角度值,
		evt.beta = (evt.y * (180 / Math.PI)); //转换成角度值
		evt.alpha = (evt.z * (180 / Math.PI)); //转换成角度值
	}
	/* beta:  -180..180 (rotation around x axis) */
		/* gamma:  -90..90  (rotation around y axis) */
		/* alpha:    0..360 (rotation around z axis) (-180..180) */

	var gamma = evt.gamma;
	var beta = evt.beta;
	var alpha = evt.alpha;

	if(evt.accelerationIncludingGravity){
	// window.removeEventListener('deviceorientation', oriCallback, false);
	gamma = evt.accelerationIncludingGravity.x*10
	beta = -evt.accelerationIncludingGravity.y*10
	alpha = evt.accelerationIncludingGravity.z*10
	}

	GameObj.acceleration.gamma = gamma;
	GameObj.acceleration.beta = beta;
	GameObj.acceleration.alpha = alpha;


	document.querySelector("#test").innerHTML = "x: "+ beta.toFixed(2) + " y: " + gamma.toFixed(2) + " z: " + (alpha != null?alpha.toFixed(2):0);
	              	
	                
	                  

	          
}


	
</script>
<script type="text/javascript">GameObj.addOrientaionListener(oriCallback);</script>	
</body>
</html>





